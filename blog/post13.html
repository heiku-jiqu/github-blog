<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="/github-blog/favicon.png" />
		<meta name="viewport" content="width=device-width" />
		<meta http-equiv="content-security-policy" content=""><link href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-gruvbox-light.min.css" rel="stylesheet" data-svelte="svelte-uyunbu">
	<link href="/github-blog/_app/immutable/assets/_layout-ff0af52f.css" rel="stylesheet">
	<link href="/github-blog/_app/immutable/assets/_page-5446419d.css" rel="stylesheet">
	<link href="/github-blog/_app/immutable/assets/post2-596b4ea1.css" rel="stylesheet">
	<link href="/github-blog/_app/immutable/assets/post7-2631a1d6.css" rel="stylesheet">
	<link rel="modulepreload" href="/github-blog/_app/immutable/start-10851b03.js">
	<link rel="modulepreload" href="/github-blog/_app/immutable/chunks/preload-helper-aa6bc0ce.js">
	<link rel="modulepreload" href="/github-blog/_app/immutable/chunks/index-4cbca6b4.js">
	<link rel="modulepreload" href="/github-blog/_app/immutable/chunks/singletons-bd722860.js">
	<link rel="modulepreload" href="/github-blog/_app/immutable/chunks/paths-6cd3a76e.js">
	<link rel="modulepreload" href="/github-blog/_app/immutable/components/pages/_layout.svelte-a0552754.js">
	<link rel="modulepreload" href="/github-blog/_app/immutable/chunks/index-6d9ae0b7.js">
	<link rel="modulepreload" href="/github-blog/_app/immutable/modules/pages/_layout.js-edc6bf67.js">
	<link rel="modulepreload" href="/github-blog/_app/immutable/chunks/_layout-a4fc2e89.js">
	<link rel="modulepreload" href="/github-blog/_app/immutable/components/pages/blog/_blogpost_/_page.svelte-58e879a6.js">
	<link rel="modulepreload" href="/github-blog/_app/immutable/modules/pages/blog/_blogpost_/_page.js-5598c8c4.js">
	<link rel="modulepreload" href="/github-blog/_app/immutable/chunks/_page-39ff3cad.js">
	</head>
	<body>
		<div>




<header class="svelte-qm05bo"><a href="/github-blog/" class="svelte-qm05bo">Home</a>

	<nav><ul class="svelte-qm05bo"><li><a href="/github-blog/blog" class="svelte-qm05bo">Blog</a></li>
			<li><a href="/github-blog/about" class="svelte-qm05bo">About</a></li></ul></nav>
</header>
<div><div class="grid-container svelte-14l03dd"><div class="sides"></div>
		<div class="article svelte-14l03dd"><h1>Javascript ArrayBuffer, TypedArray, DataView, TextDecoder, Blob, File</h1>
<p>When working with binary data in Javascript, there’s a lot of classes that can be potentially used, and they all seem to do the same thing: deal with binary data.</p>
<p>What are the nuances and differences between all the different types, and when should we use which class?</p>
<h2>ArrayBuffer</h2>
<p>The most basic type is the ArrayBuffer.</p>
<p>What is an ArrayBuffer? It is a <em>reference</em> to a fixed-length, contiguous (array of) memory area.</p>
<p>An ArrayBuffer can be created with <code>new ArrayBuffer(8)</code>, where the input is the number of bytes (length of the memory area) that it references.
When it is created, a contiguous segment of memory will be <em>allocated</em>, based on the length that was supplied in the input, and it is pre-filled with zeroes.</p>
<p>Note: the word <em>array</em> used above is not related to the normal Javascript <code>Array</code>, but rather indicates a <em>memory array</em> as in the context of lower level programming concept.</p>
<p>Note: <em>allocation</em> of memory means to reserve (that segment of) memory in that is available in the computer’s RAM.</p>
<p>ArrayBuffers are just references to a memory location, and it is <strong>not possible to manipulate the bytes directly using ArrayBuffer</strong> (although it is possible to <em>resize</em> the buffer).
Furthermore, the bytes in this memory location by itself is meaningless, just a bunch of 1s and 0s.</p>
<p>In order to manipulate the bytes and give them meaning, we must do it through a view (using TypedArrays or DataViews)</p>
<h2>TypedArray</h2>
<p>TypedArrays are an umbrella term for a bunch of different classes such as Uint8Array, Float64Array, etc.
They are ‘views’ into the array buffer and give <em>meaning</em> to the bytes that exists in the ArrayBuffers.
For instance, a Uint8Array will imply that every 8 bits (or 1 byte) is an integer. And this same relationship applies for other TypedArray, i.e. Uint16Array means an integer every 16 bits (2 bytes), Float64Array means a decimal point number every 64 bits (8 bytes), etc.</p>
<pre class="language-js"><!-- HTML_TAG_START --><code class="language-js"><span class="token keyword">let</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// create new array buffer of length 16 BYTES</span>
<span class="token comment">// create a view of the buffer, where every 4 bytes represent one uint32</span>
<span class="token keyword">let</span> uint32arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint32Array</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// typedarray can be indexed</span>
uint32arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">322</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>uint32arr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [322, 0, 0, 0]</span>
<span class="token comment">// note the rest of the values are 0</span>
<span class="token comment">// note that there are only 4 items because len_of_buffer / len_of_uint32 = 4</span>

<span class="token comment">// you can reference the underlying arraybuffer</span>
uint32arr<span class="token punctuation">.</span>buffer<span class="token punctuation">;</span>

<span class="token comment">// note that assigning number larger than what the type can hold will overflow</span>
<span class="token keyword">let</span> uint8arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// this will automatically create an underlying buffer</span>
uint8arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
uint8arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">256</span><span class="token punctuation">;</span>
uint8arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">257</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>uint8arr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [255, 0, 1]</span></code><!-- HTML_TAG_END --></pre>
<p>TypedArray has most of the regular Array methods like <code>map</code>, <code>slice</code>, <code>find</code>, <code>reduce</code> etc.</p>
<h2>DataView</h2>
<p>DataViews are flexible alternatives to TypedArrays as they don’t declare <em>upfront</em> what type, but rather the type is specified during usage of the view using its <code>.get</code> and <code>.set</code> typed methods.</p>
<pre class="language-js"><!-- HTML_TAG_START --><code class="language-js"><span class="token keyword">let</span> buff <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> dv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataView</span><span class="token punctuation">(</span>buff<span class="token punctuation">)</span><span class="token punctuation">;</span>
dv<span class="token punctuation">.</span><span class="token function">setInt8</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// at 0 byte offset from start of view, set value to 20</span>
dv<span class="token punctuation">.</span><span class="token function">setFloat32</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// at 1 byte offset from start of view, set value to Math.PI</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dv<span class="token punctuation">.</span><span class="token function">getInt8</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 20 // at 0 byte offset, read as Int8</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dv<span class="token punctuation">.</span><span class="token function">getFloat32</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3.141... // at 1 byte offset, read the next 4 bytes as Float32</span></code><!-- HTML_TAG_END --></pre>
<p>From the above example, you can see DataView can be useful when the buffer contains multiple types.</p>
<h2>TextDecoder and TextEncoder</h2>
<p>If the binary data is a string instead of numbers, you can use <code>TextDecoder</code> to decode the binary.
It supports many encodings <a href="https://developer.mozilla.org/en-US/docs/Web/API/Encoding_API/Encodings" rel="nofollow">link</a>, but the default is UTF-8.</p>
<p>A <code>TextEncoder</code> encodes a JavaScript string into a Uint8Array UTF-8 encoded text. It <em>only supports UTF-8 encoding</em>.</p>
<pre class="language-js"><!-- HTML_TAG_START --><code class="language-js"><span class="token keyword">let</span> encoder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
encoded_utf8 <span class="token operator">=</span> encoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>encoded_utf8<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Uint8Array[72, 101, 108, 108, 111]</span>

<span class="token keyword">let</span> decoder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
decoded_text <span class="token operator">=</span> decoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>encoded_utf8<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>decoded_text<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Hello</span></code><!-- HTML_TAG_END --></pre>
<h2>Blob</h2>
<p>A <code>Blob</code> is a higher level interface, defined by the web’s File API <a href="https://www.w3.org/TR/FileAPI/" rel="nofollow">specification</a>
that represents a file-like object of immutable raw data.</p>
<p>The <code>Blob</code> constructor takes in an iterable (e.g. Array) of Blob objects, strings or buffers (e.g. ArrayBuffer, TypedArray, etc), and you can specify the MIME type of the data that is in this <code>Blob</code>.</p>
<pre class="language-js"><!-- HTML_TAG_START --><code class="language-js"><span class="token keyword">let</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'&lt;html>...&lt;/html>'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text/html'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// hello in binary</span>
<span class="token keyword">let</span> hello_blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>hello<span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">'world'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text/plain'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// you can mix types</span></code><!-- HTML_TAG_END --></pre>
<p>Although Blobs are immutable, you can use its <code>.slice()</code> method to extract out parts that you’re interesting, and create a new Blob object from the slices.
It is also possible to get the underlying ArrayBuffer through the <code>.arrayBuffer()</code> method, to do more low level processing.
And if it ever gets too big, it is possible to convert it into a ReadableStream using the <code>.stream()</code> method.</p>
<p>You can also generate URLs to Blobs which will return as ‘blob:<origin>/<uuid>’. This Blob URL is referencing data that is on the client (browser), not on the server.</uuid></origin></p>
<p>Blobs are useful for upload/download operations as you can specify the MIME type of the binary data, unlike ArrayBuffers and TypedArrays.</p>
<h2>File</h2>
<p>A <code>File</code> is also a higher level interface defined in the web’s File API spec.
It inherits (all its methods) from Blob and adds on some filesystem related capabilities.
A <code>File</code> has 2 additional properties: <code>name</code> and <code>lastModified</code>.
<code>File</code> objects are typically obtained through <code>&lt;input&gt;</code>s, but it is also possible to create it using its constructor.</p>
<p>It is possible to use the <code>FileReader</code> object to quickly read the File/Blob into ArrayBuffer/Text/DataURL.</p>
<pre class="language-html"><!-- HTML_TAG_START --><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onchange</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">showFile</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span> <span class="token punctuation">/></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
	<span class="token keyword">function</span> <span class="token function">showFile</span><span class="token punctuation">(</span><span class="token parameter">input</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token comment">// input.files is an Array as user can select multiple files</span>
		<span class="token keyword">let</span> file <span class="token operator">=</span> input<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

		<span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">File name: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>file<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// e.g my.png</span>
		<span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">Last modified: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>file<span class="token punctuation">.</span>lastModified<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// e.g 1552830408824</span>
	<span class="token punctuation">&#125;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code><!-- HTML_TAG_END --></pre>
<h1>References / Further Reading</h1>
<ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/File" rel="nofollow">File</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Blob" rel="nofollow">Blob</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer" rel="nofollow">ArrayBuffer</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray" rel="nofollow">TypedArray</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/TextDecoder" rel="nofollow">TextDecoder</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/TextEncoder" rel="nofollow">TextEncoder</a></li></ul></div>
		<div class="sides"></div></div></div>


		<script type="module" data-sveltekit-hydrate="vc83rq">
		import { start } from "/github-blog/_app/immutable/start-10851b03.js";

		start({
			env: {},
			hydrate: {
				status: 200,
				error: null,
				node_ids: [0, 5],
				params: {blogpost:"post13"},
				routeId: "blog/[blogpost]",
				data: (function(a){return [a,a]}(null)),
				form: null
			},
			paths: {"base":"/github-blog","assets":"/github-blog"},
			target: document.querySelector('[data-sveltekit-hydrate="vc83rq"]').parentNode,
			trailing_slash: "never"
		});
	</script>
	</div>
	</body>
</html>
