<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="/github-blog/favicon.png" />
		<meta name="viewport" content="width=device-width" />
		<meta http-equiv="content-security-policy" content=""><link href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-gruvbox-light.min.css" rel="stylesheet" data-svelte="svelte-uyunbu">
	<link href="/github-blog/_app/immutable/assets/_layout-ff0af52f.css" rel="stylesheet">
	<link href="/github-blog/_app/immutable/assets/_page-5446419d.css" rel="stylesheet">
	<link href="/github-blog/_app/immutable/assets/post2-596b4ea1.css" rel="stylesheet">
	<link href="/github-blog/_app/immutable/assets/post7-2631a1d6.css" rel="stylesheet">
	<link rel="modulepreload" href="/github-blog/_app/immutable/start-8e1d7148.js">
	<link rel="modulepreload" href="/github-blog/_app/immutable/chunks/preload-helper-aa6bc0ce.js">
	<link rel="modulepreload" href="/github-blog/_app/immutable/chunks/index-4cbca6b4.js">
	<link rel="modulepreload" href="/github-blog/_app/immutable/chunks/singletons-f82372f9.js">
	<link rel="modulepreload" href="/github-blog/_app/immutable/chunks/paths-6cd3a76e.js">
	<link rel="modulepreload" href="/github-blog/_app/immutable/components/pages/_layout.svelte-a0552754.js">
	<link rel="modulepreload" href="/github-blog/_app/immutable/chunks/index-6d9ae0b7.js">
	<link rel="modulepreload" href="/github-blog/_app/immutable/modules/pages/_layout.js-edc6bf67.js">
	<link rel="modulepreload" href="/github-blog/_app/immutable/chunks/_layout-a4fc2e89.js">
	<link rel="modulepreload" href="/github-blog/_app/immutable/components/pages/blog/_blogpost_/_page.svelte-58e879a6.js">
	<link rel="modulepreload" href="/github-blog/_app/immutable/modules/pages/blog/_blogpost_/_page.js-911a1291.js">
	<link rel="modulepreload" href="/github-blog/_app/immutable/chunks/_page-7ff6543a.js">
	</head>
	<body>
		<div>




<header class="svelte-qm05bo"><a href="/github-blog/" class="svelte-qm05bo">Home</a>

	<nav><ul class="svelte-qm05bo"><li><a href="/github-blog/blog" class="svelte-qm05bo">Blog</a></li>
			<li><a href="/github-blog/about" class="svelte-qm05bo">About</a></li></ul></nav>
</header>
<div><div class="grid-container svelte-14l03dd"><div class="sides"></div>
		<div class="article svelte-14l03dd"><h1>Drawing a Bar Chart</h1>
<h2>SVG fundamentals</h2>
<p>SVG provides elements that describe shapes / curves, similar to how HTML provides elements that describe headers, paragraphs.</p>
<p>SVG document starts with <code>&lt;svg&gt;</code> root element, and within it you can put various shape elements, and group those together using <code>&lt;g&gt;</code> element.</p>
<p>SVG is actually an XML language, and therefore:</p>
<ul><li>elements and attributes are case sensitive</li>
<li>attribute values must be inside quotes even if they are numbers.</li></ul>
<h3>SVG coordinate system</h3>
<p>The origin(0,0) starts at the <strong>top left</strong></p>
<p>The horizontal axis runs from left to right</p>
<p>The vertical axis runs from <strong>top to bottom</strong></p>
<h3>SVG viewbox</h3>
<p>The unit of measurement in the SVG coordinates is by default 1unit = 1px of the device’s screen.
However, since SVG is scalable, we can change the <em>viewbox</em> attribute of <code>&lt;svg&gt;</code> to (automatically) map SVG’s 1 unit to however big the screen size is.</p>
<p>For example, defining a SVG canvas: <code>&lt;svg viewBox=&quot;0 0 200 200&quot;&gt;</code>. This translates to setting canvas top left corner to (0,0) and the canvas width and height to be 200. Say the canvas is displayed in a 1000px by 1000px screen, then 1 unit in SVG = 5 px on screen.</p>
<p>This is useful because you can fix the coordinates of the viewBox, allowing the SVG element sizes to be <em>relative</em> to the viewBox you defined, letting it scale to any screen size.</p>
<h3>mapping data values to SVG unit values</h3>
<p>Now we need a way to map the values in our data to the SVG’s coordinate system.
For example, say our data consists of numbers from 0 to 10, and our SVG’s coordinate system is defined as 0 to 200 pixels. We will need to map the 0 in our data to 0 pixel in SVG, and 5 in our data to 100 pixel in SVG, etc.</p>
<p>To do this, <code>d3-scale</code> library has a lot of helper functions that can help us generate this mapping function. Specifically, <code>scaleLinear</code> helps returns a linearly interpolating function that maps values between our data and the SVG coordinate.</p>
<pre class="language-js"><!-- HTML_TAG_START --><code class="language-js"><span class="token keyword">const</span> interpolateFunction <span class="token operator">=</span> <span class="token function">scaleLinear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// returns a interpolating function</span>
	<span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// provide the min and max of our data</span>
	<span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// provide the min and max of our SVG coords</span>

<span class="token function">interpolateFunction</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns 0</span>
<span class="token function">interpolateFunction</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns 100</span>
<span class="token function">interpolateFunction</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns 200</span></code><!-- HTML_TAG_END --></pre>
<h3>vertical axis: inverted</h3>
<p>Above works fine for horizontal axis, but vertical axis is inverted in SVG.
In other words, the <strong>larger</strong> the y value, the <strong>lower</strong> the point will be shown inside the SVG.
This is not how normal charts work.
Luckily there is an easy trick to solve this using <code>scaleLinear()</code>: reverse arguments in <code>.range()</code> method!</p>
<pre class="language-js"><!-- HTML_TAG_START --><code class="language-js"><span class="token keyword">const</span> reverseInterpolate <span class="token operator">=</span> <span class="token function">scaleLinear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Note: elements in array has been swapped!</span>

<span class="token function">reverseInterpolate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns 200</span>
<span class="token function">reverseInterpolate</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns 100</span>
<span class="token function">reverseInterpolate</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns 0</span></code><!-- HTML_TAG_END --></pre>
<p>By just swapping the elements in the <code>.range()</code> method, the returned <code>reverseInerpolate</code> function now maps <strong>larger</strong> y value to a <strong>higher</strong> point inside the SVG.</p>
<h3>horizontal axis: cateogories</h3>
<p>Horizontal axis for bar charts are usually categorical variables. This means using <code>scaleLinear()</code> does not make sense.
<code>d3-scale</code> provides another helper function, <code>scaleBand()</code> that will help us interpolate the horizontal positions of the bars.
The returned function will give us the horizontal position of the <em>left</em> side of the bar (i.e. the start of the bar)</p>
<pre class="language-js"><!-- HTML_TAG_START --><code class="language-js"><span class="token keyword">const</span> categoricalInterpolate <span class="token operator">=</span> <span class="token function">scaleBand</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// provide array of your categories</span>
	<span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// provide min and max of your SVG coords</span>
    <span class="token comment">// optionally set the gaps between bars</span>
    <span class="token comment">// as a proportion of width of bar, 0 to 1</span>
    <span class="token punctuation">.</span><span class="token function">paddingInner</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token comment">// optionally set the gaps to the left and right of the first and last bar</span>
	<span class="token comment">// as a proportion of width of bar, 0 to 1</span>
	<span class="token punctuation">.</span><span class="token function">paddingOuter</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">categoricalInterpolate</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns position of left side of the 'a' bar</span>
categoricalInterpolate<span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns the length between start of 2 consecutive bars</span>
categoricalInterpoalte<span class="token punctuation">.</span><span class="token function">bandwidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns the width of the bar</span></code><!-- HTML_TAG_END --></pre>
<h3>drawing bars</h3>
<p>We can draw bars with <code>&lt;rect&gt;</code> svg element.
This element requires us to specify the rectangle’s top left position <code>x</code> and <code>y</code>, the <code>height</code> (how far down), and the <code>width</code> (how far right).</p>
<p>We can determine the 4 properties for each data point <code>(xData, yData)</code> with the two <code>d3-scale</code> interpolating functions we have created:</p>
<ul><li><code>x</code> = <code>categoricalInterpolate(xData)</code></li>
<li><code>width</code> = <code>categoricalInterpolate.bandwidth()</code></li>
<li><code>y</code> = <code>reverseInterpolate(yData)</code><ul><li>to handle negative <code>yData</code>, use <code>reverseInterpolate(Math.max(0, yData))</code> to get the yData position if its positive, or the x-axis position if yData is negative</li></ul></li>
<li><code>height</code> = <code>reverseInterpolate(yData) - reverseInterpolate(0)</code><ul><li>to handle negative <code>yData</code>, use <code>Math.abs(reverseInterpolate(yData) - reverseInterpolate(0))</code> to get distance between tip of bar and x-axis</li></ul></li></ul>


	<svg viewBox="-100 -100 1000 800"><path fill="black" d="M73,50c0-12.7-10.3-23-23-23S27,37.3,27,50 M30.9,50c0-10.5,8.5-19.1,19.1-19.1S69.1,39.5,69.1,50"><animateTransform attributeName="transform" attributeType="XML" type="rotate" dur="1s" from="0 50 50" to="360 50 50" repeatCount="indefinite"></animateTransform></path></svg>
</div>
		<div class="sides"></div></div></div>


		<script type="module" data-sveltekit-hydrate="1a05gx3">
		import { start } from "/github-blog/_app/immutable/start-8e1d7148.js";

		start({
			env: {},
			hydrate: {
				status: 200,
				error: null,
				node_ids: [0, 5],
				params: {blogpost:"post4"},
				routeId: "blog/[blogpost]",
				data: (function(a){return [a,a]}(null)),
				form: null
			},
			paths: {"base":"/github-blog","assets":"/github-blog"},
			target: document.querySelector('[data-sveltekit-hydrate="1a05gx3"]').parentNode,
			trailing_slash: "never"
		});
	</script>
	</div>
	</body>
</html>
